# TzGo - Tezos Go SDK - AI Context Guide

**Project**: Blockwatch TzGo - Low-level Tezos Go SDK  
**Language**: Go 1.18+  
**License**: Permissive (commercial & non-commercial use)  
**Maintainer**: Blockwatch Data Inc. / Trilitech  
**Module Path**: `github.com/trilitech/tzgo`

## Important External References

- **Protocol Changelogs**: [https://octez.tezos.com/docs/protocols/naming.html](https://octez.tezos.com/docs/protocols/naming.html)
- **Breaking Changes**: [https://octez.tezos.com/docs/introduction/breaking_changes.html](https://octez.tezos.com/docs/introduction/breaking_changes.html)
- **Tezos Documentation**: [https://tezos.gitlab.io/](https://tezos.gitlab.io/)
- **TzGo Repository**: [https://github.com/trilitech/tzgo](https://github.com/trilitech/tzgo)

## Project Purpose

TzGo is a comprehensive Go SDK for Tezos blockchain development focused on:
- **Correctness**: Reliable data handling and encoding
- **Stability**: Long-term API stability and backward compatibility
- **Compliance**: Support for all Tezos protocols from v001 (Alpha) to v024 (Tallinn)
- **Performance**: High-performance blockchain data processing

## Core Capabilities

1. **Read/decode** blockchain data (blocks, operations, contracts)
2. **Construct/sign** transactions and operations
3. **Smart contract interaction** (calls, storage, bigmaps)
4. **Token standards** (FA1.2, FA2, NFTs)
5. **RPC communication** with Tezos nodes
6. **Micheline encoding/decoding** (smart contract data format)
7. **Code generation** for smart contract bindings
8. **Test automation** and deployment orchestration

---

## Directory Structure

### `/tezos` - Core Types Library
**Purpose**: Fundamental Tezos types and primitives

**Key Files**:
- `address.go` - Address types (tz1/tz2/tz3/tz4, KT1, smart rollups)
  - Types: `Address`, `AddressType`, `AddressSet`
  - Functions: `ParseAddress()`, `NewAddress()`, `EncodeAddress()`
- `key.go` - Public/private keys, key generation, encryption
  - Types: `Key`, `PrivateKey`, `KeyType` (Ed25519, Secp256k1, P256, BLS)
  - Functions: `GenerateKey()`, `ParseKey()`, `ParsePrivateKey()`
- `sig.go` - Digital signatures
  - Types: `Signature`, `SignatureType`
  - Functions: `ParseSignature()`, `Verify()`
- `hash.go` - All Tezos hash types (block, operation, protocol, etc.)
  - Types: `BlockHash`, `OperationHash`, `ProtocolHash`, `ChainIdHash`
- `op.go` - Operation types and tags
  - Types: `OpType`, `OpStatus`
  - Constants: All operation types (transaction, delegation, origination, etc.)
- `params.go` - Network/protocol parameters
  - Type: `Params` - Contains protocol-specific configuration
- `zarith.go` - Zarith number encoding (Z, N types)
  - Types: `Z` (big.Int wrapper), `N` (int64 wrapper)
- `protocols.go` - Protocol history and versioning
  - Types: `Deployment`, `ProtocolHistory`
- `voting.go` - Governance voting types
  - Types: `VotingPeriodKind`, `BallotVote`, `FeatureVote`

**Common Patterns**:
- Most types have `Parse*()` and `MustParse*()` functions
- Implements `encoding.TextMarshaler` and `encoding.TextUnmarshaler`
- Base58 encoding for human-readable strings
- Binary encoding for on-chain data

---

### `/codec` - Binary Operation Encoding
**Purpose**: Construct, serialize, and sign Tezos operations

**Key Files**:
- `op.go` - Operation container and serialization
  - Type: `Op` - Main operation builder
  - Methods: `NewOp()`, `WithContents()`, `WithParams()`, `Sign()`, `Encode()`
- `transaction.go` - Transaction operation
  - Type: `Transaction`
- `delegation.go` - Delegation operation
  - Type: `Delegation`
- `origination.go` - Contract origination
  - Type: `Origination`
- `reveal.go` - Public key reveal operation
  - Type: `Reveal`
- `endorsement.go` - Endorsement/attestation
  - Type: `Endorsement`
- `smart_rollup_*.go` - Smart rollup operations
  - Types: `SmartRollupOriginate`, `SmartRollupPublish`, `SmartRollupCement`, etc.
- `manager.go` - Manager operation wrapper
  - Type: `Manager` - Base for user operations

**Usage Pattern**:
```go
op := codec.NewOp().
    WithParams(params).
    WithContents(&codec.Transaction{...}).
    WithContents(&codec.Reveal{...})
err := op.Sign(privateKey)
bytes, _ := op.MarshalBinary()
```

---

### `/rpc` - Tezos Node RPC Client
**Purpose**: Communicate with Tezos RPC nodes

**Key Files**:
- `client.go` - Main RPC client
  - Type: `Client`
  - Functions: `NewClient()`, `Init()`
  - Features: Observers, metadata modes, signing
- `block.go` - Block data queries
  - Types: `Block`, `BlockHeader`
  - Methods: `GetBlock()`, `GetBlockHeight()`
- `contracts.go` - Contract queries
  - Methods: `GetContract()`, `GetContractStorage()`, `GetBigmapValue()`
- `operations.go` - Operation queries
  - Types: `Operation`, `OperationList`
- `constants.go` - Protocol constants
  - Type: `Constants`
- `mempool.go` - Mempool monitoring
  - Types: `Mempool`, `PendingOperations`
- `monitor.go` - Chain monitoring (subscriptions)
  - Methods: `MonitorBlocks()`, `MonitorOperations()`
- `delegates.go` - Baker/delegate queries
  - Methods: `GetDelegate()`, `GetDelegateBalance()`
- `rights.go` - Baking/endorsing rights
  - Methods: `GetBakingRights()`, `GetEndorsingRights()`
- `observer.go` - Event observer for operation inclusion
  - Type: `Observer`

**Usage Pattern**:
```go
client, _ := rpc.NewClient("https://rpc.tzpro.io", nil)
client.Init(ctx)
block, _ := client.GetBlock(ctx, rpc.Head)
contract, _ := client.GetContract(ctx, address, rpc.Head)
```

---

### `/micheline` - Micheline Data Handling
**Purpose**: Decode, encode, and manipulate Micheline (smart contract data format)

**Key Files**:
- `primitives.go` - Core Micheline primitive type
  - Type: `Prim` - Universal Micheline container
  - Types: `PrimType`, `OpCode`
  - Methods: `Unpack()`, `UnpackAll()`, `Pack()`
- `type.go` - Type wrapper with annotations
  - Type: `Type` - Represents Micheline types
  - Methods: `Unfold()`, `FindType()`
- `value.go` - Value wrapper for data + type
  - Type: `Value`
  - Methods: `GetInt64()`, `GetString()`, `GetAddress()`, `Map()`
- `key.go` - Comparable values (for maps/bigmaps)
  - Type: `Key`
- `marshal.go` - Binary encoding
  - Functions: `Marshal()`, `Unmarshal()`
- `unmarshal.go` - JSON decoding
- `opcodes.go` - Micheline/Michelson opcodes
  - Constants: All Michelson instructions and types
- `script.go` - Smart contract scripts
  - Type: `Script` - Contains code, storage
- `parameters.go` - Entrypoint parameters
  - Type: `Parameters` - Call parameters with entrypoint
- `entrypoint.go` - Entrypoint definitions
  - Type: `Entrypoints`
- `bigmap.go` - Bigmap handling
  - Type: `BigmapValue`, `BigmapDiff`
- `builder.go` - Build Micheline from Go values
  - Type: `Builder`

**Common Use Cases**:
- Decode contract storage: `prim.Unpack()` → `Type.Unfold()` → `Value.Map()`
- Encode call parameters: Build with `Builder` or construct `Prim` manually
- Read bigmap: Query via RPC, decode with `Type.Unfold()`

---

### `/contract` - Smart Contract Interactions
**Purpose**: High-level contract interaction helpers

**Key Files**:
- `contract.go` - Generic contract wrapper
  - Type: `Contract`
  - Methods: `NewContract()`, `Call()`, `Resolve()`
- `fa12.go` - FA1.2 token standard (Tezos token v1)
  - Type: `FA1Token`
  - Types: `FA1Transfer`, `FA1Approval`, `FA1TransferArgs`
  - Methods: `Transfer()`, `Approve()`, `GetBalance()`
- `fa2.go` - FA2 token standard (Tezos multi-asset)
  - Type: `FA2Token`
  - Types: `FA2Transfer`, `FA2Approval`, `FA2TransferArgs`
  - Methods: `Transfer()`, `UpdateOperators()`, `BalanceOf()`
- `nft.go` - NFT-specific helpers
  - Type: `NftLedger`, `NftLedgerEntry`
- `token.go` - Generic token interface
  - Interfaces covering FA1.2 and FA2
- `tz16.go` - Contract metadata standard (TZIP-16)
  - Type: `Tz16`, `Tz16License`
  - Methods: `Resolve()`, `Fetch()`
- `wellknown.go` - Known contract addresses
- `ast/` - Abstract syntax tree parsing
- `bind/` - Contract binding generation

---

### `/signer` - Transaction Signing
**Purpose**: Local and remote transaction signing

**Key Files**:
- `signer.go` - Signer interface
  - Interface: `Signer`
- `memory.go` - In-memory signer
  - Type: `MemorySigner`
- `remote/` - Remote signer support (hardware wallets, remote services)

**Usage**:
```go
signer := signer.NewFromKey(privateKey)
client.Signer = signer
```

---

### `/base58` - Base58 Encoding
**Purpose**: Tezos-specific base58check encoding

**Key Files**:
- `base58.go` - Base58 encoding/decoding
  - Functions: `Encode()`, `Decode()`, `CheckEncode()`, `CheckDecode()`
- `base58check.go` - Base58check with checksums
- `alphabet.go` - Bitcoin alphabet used by Tezos

**Note**: Used internally by address, key, signature, and hash types

---

### `/hash` - Efficient Hash Utilities
**Purpose**: High-performance hash maps and FNV hashing

**Key Files**:
- `hashmap.go` - Optimized hash map implementations
- `fnv.go` - FNV hash functions

---

### `/cmd` - Command-Line Tools

#### `/cmd/tzgen` - Code Generator
**Purpose**: Generate Go bindings for smart contracts

**Features**:
- Generate Go structs from Micheline types
- Create type-safe entrypoint interfaces
- Read from deployed contracts or Micheline files
- Support for go:generate

**Usage**:
```bash
tzgen -name MyContract -pkg mycontract -address KT1... -out contract.go
tzgen -name MyContract -pkg mycontract -src script.json -out contract.go
```

**Output**: Go source file with:
- Type definitions for storage and parameters
- Methods to call each entrypoint
- Encoding/decoding helpers

#### `/cmd/tzcompose` - Automation Tool
**Purpose**: Define and execute complex transaction workflows

**Features**:
- YAML-based pipeline definitions
- Multi-step transaction sequences
- Contract deployment automation
- Traffic generation and testing
- Clone contracts between networks

**Task Types**:
- `deploy` - Originate contracts
- `call` - Call contract entrypoints
- `transfer` - Send tez
- `token_transfer` - Send tokens (FA1.2/FA2)
- `token_approve` - Approve token spenders
- `delegate` - Delegate to baker
- `batch` - Bundle multiple ops
- `wait` - Wait for conditions
- And many more...

**Usage**:
```bash
tzcompose run -f pipeline.yaml -rpc https://rpc.tzpro.io
tzcompose simulate -f pipeline.yaml
tzcompose validate -f pipeline.yaml
```

#### `/cmd/tzgenesis` - Genesis Block Tool
**Purpose**: Work with genesis blocks and protocol initialization

---

### `/internal` - Internal Utilities
**Purpose**: Shared internal code (not part of public API)

**Subdirectories**:
- `compose/` - TzCompose internal logic
- `generate/` - TzGen internal logic
- `parse/` - Parsing utilities

---

### `/examples` - Usage Examples

**Available Examples**:
- `addr/` - Address handling
- `key/` - Key generation and usage
- `rpc/` - RPC client usage
- `contract/` - Contract interactions
- `transfer/` - Token transfers
- `tx/` - Transaction construction
- `fa12/` - FA1.2 token usage
- `mempool/` - Mempool monitoring
- `params/` - Protocol parameters
- `doublebake/` - Evidence handling
- `tzgen/` - Code generation
- `tzcompose/` - Automation examples
- `unpack/` - Micheline unpacking

---

## Key Concepts and Types

### Address Types
- **tz1** - Ed25519 public key hash (implicit account)
- **tz2** - Secp256k1 public key hash (implicit account)
- **tz3** - P256 public key hash (implicit account)
- **tz4** - BLS public key hash (implicit account)
- **KT1** - Originated contract (smart contract)
- **txr1** - Transaction rollup (deprecated)
- **sr1** - Smart rollup
- **scr1** - Smart contract rollup commitment

### Operation Types
Common operations (see `tezos/op.go` for full list):
- `OpTypeTransaction` - Tez transfer or contract call
- `OpTypeDelegation` - Delegate to baker
- `OpTypeOrigination` - Deploy smart contract
- `OpTypeReveal` - Reveal public key
- `OpTypeEndorsement` - Endorse block (Tenderbake)
- `OpTypeProposals` - Submit protocol proposals
- `OpTypeBallot` - Vote on protocol proposals
- Smart rollup operations (15+ types)

### Micheline Structure
- **Prim** - Atomic Micheline element (int, string, bytes, sequence, or instruction)
- **Type** - Annotated type specification
- **Value** - Data with type context
- **OpCode** - Michelson instruction or type (T_INT, I_TRANSFER, etc.)

### Protocol Versions & Changelogs

Complete protocol documentation: [Protocol Naming Convention](https://octez.tezos.com/docs/protocols/naming.html)

- v001-v003: Alpha (genesis)
- v004: [Athens](https://octez.tezos.com/docs/protocols/004_Pt24m4xi.html)
- v005: [Babylon](https://octez.tezos.com/docs/protocols/005_babylon.html)
- v006: [Carthage](https://octez.tezos.com/docs/protocols/006_carthage.html)
- v007: [Delphi](https://octez.tezos.com/docs/protocols/007_delphi.html)
- v008: [Edo](https://octez.tezos.com/docs/protocols/008_edo.html)
- v009: [Florence](https://octez.tezos.com/docs/protocols/009_florence.html)
- v010: [Granada](https://octez.tezos.com/docs/protocols/010_granada.html)
- v011: [Hangzhou](https://octez.tezos.com/docs/protocols/011_hangzhou.html)
- v012: [Ithaca](https://octez.tezos.com/docs/protocols/012_ithaca.html)
- v013: [Jakarta](https://octez.tezos.com/docs/protocols/013_jakarta.html)
- v014: [Kathmandu](https://octez.tezos.com/docs/protocols/014_kathmandu.html)
- v015: [Lima](https://octez.tezos.com/docs/protocols/015_lima.html)
- v016: [Mumbai](https://octez.tezos.com/docs/protocols/016_mumbai.html)
- v017: [Nairobi](https://octez.tezos.com/docs/protocols/017_nairobi.html)
- v018: [Oxford](https://octez.tezos.com/docs/protocols/018_oxford.html)
- v019-v020: [Paris](https://octez.tezos.com/docs/protocols/020_paris.html)
- v021: [Quebec](https://octez.tezos.com/docs/protocols/021_quebec.html)
- v022: [Rio](https://octez.tezos.com/docs/protocols/022_rio.html)
- v023: [Seoul](https://octez.tezos.com/docs/protocols/023_seoul.html)
- v024: [Tallinn](https://octez.tezos.com/docs/protocols/024_tallinn.html) (current)

### Recent Protocol Changes Summary

#### Tallinn (v024) - [Full Changelog](https://octez.tezos.com/docs/protocols/024_tallinn.html)
**Key Changes**:
- **6s Block Time**: Reduced from 8s to 6s on mainnet
- **Removed Fields**: `adaptive_issuance_vote` from block header; `adaptive_issuance_vote_ema` and `adaptive_issuance_activation_cycle` from metadata
- **All Bakers Attest**: New consensus feature with threshold-based activation
- **New Michelson Instructions**: `INDEX_ADDRESS` and `GET_ADDRESS_INDEX` for address indexing
- **Breaking RPC Changes**: Validators RPC now groups by level; issuance rewards per block instead of per slot
- **Protocol Parameters**: Updated for 6s blocks (blocks_per_cycle: 10800→14400, max_operations_ttl: 450→600, etc.)

#### Seoul (v023) - [Full Changelog](https://octez.tezos.com/docs/protocols/023_seoul.html)
**Key Changes**:
- **BLS Signatures (tz4)**: Environment V15 with Proof of Possession scheme
- **Aggregate Operations**: New `Preattestations_aggregate` and `Attestations_aggregate` operations
- **Evidence Operations**: Replaced double evidence ops with unified `Double_consensus_operation_evidence`
- **Reveal Changes**: New optional `proof` field for tz4 addresses (breaking change)
- **Companion Keys**: New `Update_companion_key` operation for tz4 attestations
- **All tz4 Unrevealed**: Existing tz4 addresses must re-reveal with proof

#### Rio (v022) - [Full Changelog](https://octez.tezos.com/docs/protocols/022_rio.html)
**Key Changes**:
- **One-Day Cycles**: `blocks_per_cycle` reduced from 30720 to 10800 (~1 day with 8s blocks)
- **DAL Incentives**: Feature flag enabled; new DAL rewards and entrapment evidence
- **Feature Flags**: Added `aggregate_attestation` and `allow_tz4_delegate_enable` (inactive in Rio)
- **Protocol Parameters**: Voting periods adjusted to 14 cycles, tolerated inactivity to 2 cycles
- **Gas Fix**: Increased gas cost for transfers to user accounts (~2000 gas units)

#### Quebec (v021) - [Full Changelog](https://octez.tezos.com/docs/protocols/021_quebec.html)
**Key Changes**:
- **8s Block Time**: Reduced from 10s to 8s on mainnet
- **Adaptive Maximum**: New bound on issuance based on staked ratio
- **Smart Rollups**: Support for `contract _` type in messages; WASM PVM bumped to V5
- **Breaking RPC Changes**: Extensive staking/delegation RPC restructure (many renamed/deprecated)
- **Staking Parameters**: `edge_of_staking_over_delegating`: 2→3, `GLOBAL_LIMIT`: 5→9

#### Oxford (v018) - [Full Changelog](https://octez.tezos.com/docs/protocols/018_oxford.html)
**Key Changes**:
- **Attestation Rename**: "Endorsement" terminology changed to "Attestation" throughout
- **Adaptive Issuance (experimental)**: Staking mechanism introduced (feature-flagged on mainnet)
- **Smart Rollups**: Private rollups with whitelists; WASM PVM 2.0.0; removed origination proof
- **Adaptive Slashing**: New slashing mechanism with percentage-based penalties
- **Balance Updates**: New `Deposits` and `Unstaked_deposits` kinds in receipts
- **Breaking Parameters**: Renamed punishment parameters to percentage-based values

#### Paris (v019-v020) - [Full Changelog](https://octez.tezos.com/docs/protocols/020_paris.html)
**Key Changes**:
- **Adaptive Issuance Activation**: Staking and AI features fully activated on mainnet
- **Consensus Rights Delay**: Reduced from 5 to 2 cycles
- Various staking and issuance mechanism refinements

---

## Octez Version History

**Release History**: [Octez Releases History](https://octez.tezos.com/docs/releases/history.html)

### Recent Octez Versions Summary

#### Octez v24.1 (Current) - [Full Release Notes](https://octez.tezos.com/docs/releases/version-24.html)
**Release Date**: 2024-2025  
**Key Changes**:
- **Tallinn Protocol Support**: Protocol environment V15
- **Deprecated**: Protocol-specific baker/accuser executables (will be removed in v25)
- **Mandatory**: Use protocol-independent `octez-baker` and `octez-accuser`
- **Breaking**: RPM packages no longer provided (use other installation methods)
- **New**: Octez Releases page at [octez.tezos.com/releases](https://octez.tezos.com/releases/)
- **Requirements**: opam 2.3+ for building from sources
- **Hardware**: 3 CPU cores, 8GB RAM + 8GB swap, 100GB SSD

#### Octez v23.3 - [Full Release Notes](https://octez.tezos.com/docs/releases/version-23.html)
**Key Changes**:
- **Seoul Protocol Support**: Protocol environment V15
- **New**: Protocol-independent `octez-baker` and `octez-accuser` executables
- **BLS Support**: Client commands and node RPCs for tz4 delegates and native multisig
- **Breaking**: Operation encoding changes for reveal operations (tz4 compatibility)
- **New Snapshot Version**: Version 9 (improved baking after import; not backward compatible)
- **DAL Performance**: Increased performance and improved baker stability
- **Hardware**: Same minimal specs as v24

#### Octez v22.1 - [Full Release Notes](https://octez.tezos.com/docs/releases/version-22.html)
**Key Changes**:
- **Rio Protocol Support**: Protocol environment V14
- **OCaml 5**: Compiled with OCaml 5.2.1 (upgraded from 4.14.2)
- **DAL Mandatory**: Baker requires `--dal-node` endpoint or `--without-dal` flag
- **History Mode Change**: Default changed from `Full` to `Rolling`
- **Experimental**: Agnostic baker (`octez-experimental-agnostic-baker`) introduced
- **New Packages**: Debian and RPM packages restructured
- **Hardware**: Same minimal specs as v24

#### Octez v21.x - [Full Release Notes](https://octez.tezos.com/docs/releases/version-21.html)
**Key Changes**:
- **Quebec Protocol Support**: Protocol environment V13
- **DAL Option**: Introduced `--without-dal` baker option (became mandatory in v22)
- **WASM PVM**: Version 5 support

#### Octez v20.x - [Full Release Notes](https://octez.tezos.com/docs/releases/version-20.html)
**Key Changes**:
- **Paris Protocol Support**: Adaptive Issuance activation

### Important Octez Version Notes

**Baker Evolution**:
- v22: Introduced experimental agnostic baker
- v23: Released production `octez-baker` and `octez-accuser` (protocol-independent)
- v24: Deprecated protocol-specific executables (e.g., `octez-baker-PsQuebec`)
- v25: Will remove protocol-specific executables entirely

**DAL Requirements**:
- v21.3: Introduced optional `--without-dal` flag
- v22: Made DAL endpoint or `--without-dal` flag **mandatory** for bakers
- Bakers must either run a DAL node or explicitly opt out

**Compiler & Build**:
- v21 and earlier: OCaml 4.14.2
- v22+: OCaml 5.2.1
- v24+: Requires opam 2.3 or later

**Package Distribution**:
- v22+: New Debian and RPM package structure
- v24+: RPM packages discontinued (use other methods)

**Breaking Changes by Version**:
- **v24**: [Breaking Changes](https://octez.tezos.com/docs/introduction/breaking_changes.html#v24-breaking-changes)
- **v23**: [Breaking Changes](https://octez.tezos.com/docs/introduction/breaking_changes.html#v23-breaking-changes)
- **v22**: DAL requirement, history mode default change

---

## Common Workflows

### 1. Send a Transaction
```go
// Create client
client, _ := rpc.NewClient("https://rpc.tzpro.io", nil)
client.Init(ctx)

// Get account
source := tezos.MustParseAddress("tz1...")
dest := tezos.MustParseAddress("tz1...")

// Build operation
op := codec.NewOp().
    WithSource(source).
    WithContents(&codec.Transaction{
        Manager: codec.Manager{
            Source: source,
        },
        Destination: dest,
        Amount: tezos.NewN(1000000), // 1 XTZ
    })

// Sign and send
op.Sign(privateKey)
client.Broadcast(ctx, op)
```

### 2. Call Smart Contract
```go
// Get contract
contract := contract.NewContract(contractAddr, client)

// Build parameters
params := micheline.Parameters{
    Entrypoint: "transfer",
    Value: /* build Prim here */,
}

// Create call
txArgs := contract.Call(params, source)
op := txArgs.Encode()

// Complete and send
op.WithParams(client.Params)
op.Sign(privateKey)
client.Broadcast(ctx, op)
```

### 3. Decode Contract Storage
```go
// Get contract storage
script, _ := client.GetContractScript(ctx, contractAddr, rpc.Head)
storage := script.Storage

// Unfold into structured type
typ := script.StorageType()
val, _ := typ.Unfold(storage)

// Access fields
records := val.Map()
myField := records["myfield"].GetString()
```

### 4. Monitor Operations
```go
// Set up observer
observer := client.BlockObserver

// Watch for operation
opHash := tezos.MustParseOpHash("oo...")
result := <-observer.WatchOperation(ctx, opHash, nil)

if result.Err != nil {
    // Operation failed
}
// Operation confirmed
```

---

## Important Notes for AI Agents

### Type Safety
- Always use `MustParse*()` functions only when input is guaranteed valid
- Use `Parse*()` and check errors for user input
- Prefer `NewAddress()`, `NewKey()`, etc. for construction from bytes

### Binary vs JSON Encoding
- Binary: Used for on-chain data, signing, RPC submission
- JSON: Used for RPC responses, human-readable formats
- Most types support both via `MarshalBinary()` and `MarshalJSON()`

### Protocol Compatibility
- Always set `Params` on operations to ensure correct encoding
- Use `client.Params` for current network parameters
- Check protocol version for feature availability

### Micheline Complexity
- Micheline is type-safe but verbose
- Always unfold into `Type` → `Value` for structured access
- Use `Unpack()` if data is packed with PACK instruction
- Annotations (`:field`, `@param`) are critical for field names

### Error Handling
- Most functions return errors
- Network operations can fail (use retries)
- Binary decoding can fail with malformed data
- Micheline unfolding requires matching type information

### Bigmaps
- Bigmaps are not stored in contract storage directly
- Access via `GetBigmapValue()` RPC call
- Updates tracked in operation receipts as `BigmapDiff`

### Testing
- Use sandbox or testnet for development
- TzCompose excellent for test setup automation
- Examples directory contains working test cases

### Code Generation
- TzGen eliminates manual Micheline encoding
- Generated code is type-safe and easier to maintain
- Re-generate when contract changes

---

## Dependencies

Key external dependencies:
- `golang.org/x/crypto` - Cryptographic primitives
- `github.com/decred/dcrd/dcrec/secp256k1/v4` - Secp256k1 signatures
- `github.com/echa/bson` - BSON encoding
- `github.com/tidwall/gjson` - JSON parsing

---

## File Naming Conventions

- `*_test.go` - Test files
- `*.go` - Implementation
- `README.md` - Documentation
- `LICENSE` - License files
- No build tags, pure Go

---

## Common Gotchas

1. **Watermarks**: Operations must be signed with correct watermark byte
2. **Counters**: Manager operations need sequential counter values
3. **Gas/Storage**: Always set limits or use simulation
4. **Entrypoint names**: Case-sensitive, default is "default"
5. **Addresses**: 21 bytes internally, base58check externally
6. **Zarith encoding**: Variable-length encoding for large numbers
7. **Protocol changes**: Features vary by protocol version
8. **Metadata modes**: Some nodes prune metadata, use MetadataModeAlways
9. **Nil pointer checks**: Always check for nil before dereferencing pointers (e.g., `AdaptiveIssuanceVote` in BlockHeader)
10. **Tallinn protocol breaking change**: The `adaptive_issuance_vote` field was removed from block headers in Tallinn protocol (v024). Always check for nil when accessing `AdaptiveIssuanceVote`. See [official breaking changes](https://octez.tezos.com/docs/introduction/breaking_changes.html#protocol-tallinn)

---

## Quick Reference: Import Paths

```go
import (
    "github.com/trilitech/tzgo/codec"       // Build & sign operations
    "github.com/trilitech/tzgo/tezos"       // Core types
    "github.com/trilitech/tzgo/micheline"   // Smart contract data
    "github.com/trilitech/tzgo/rpc"         // RPC client
    "github.com/trilitech/tzgo/contract"    // Contract helpers
    "github.com/trilitech/tzgo/signer"      // Transaction signing
    "github.com/trilitech/tzgo/base58"      // Encoding (rarely needed)
)
```

---

## When to Use What

| Task | Package | Key Type/Function |
|------|---------|-------------------|
| Parse address | `tezos` | `ParseAddress()` |
| Generate keys | `tezos` | `GenerateKey()` |
| Build transaction | `codec` | `NewOp()`, `Transaction` |
| Call contract | `contract` | `Contract.Call()` |
| Query RPC | `rpc` | `Client.Get*()` |
| Decode storage | `micheline` | `Type.Unfold()`, `Value.Map()` |
| Sign operation | `signer` | `Signer.Sign()` |
| FA1.2 token | `contract` | `FA1Token` |
| FA2 token | `contract` | `FA2Token` |
| Generate code | `cmd/tzgen` | CLI tool |
| Automate deployment | `cmd/tzcompose` | CLI tool |

---

## Support and Resources

- **Documentation**: README.md files in each directory
- **Examples**: `/examples` directory
- **Tests**: `*_test.go` files show usage patterns
- **GitHub**: https://github.com/trilitech/tzgo
- **RPC Endpoint**: https://rpc.tzpro.io (requires API key for heavy use)
- **Protocol Docs**: https://tezos.gitlab.io/

---

## Version Information

- **Current Version**: 1.17.0 (see rpc/client.go)
- **Go Version**: 1.18+ required
- **Latest Protocol**: Tallinn (v024)
- **Stability**: Stable API, production-ready

---

## AI Agent Guidelines

1. **Always check protocol version** before suggesting features
2. **Use examples** as reference for correct usage patterns
3. **Import paths** must use `github.com/trilitech/tzgo`
4. **Error handling** is critical - never ignore errors
5. **Context** is required for all RPC operations (use `context.Context`)
6. **Test code** against examples to verify correctness
7. **Micheline operations** are complex - reference existing code
8. **Binary encoding** must match protocol version exactly
9. **Token standards** have specific parameter formats (FA1.2 vs FA2)
10. **TzGen** should be suggested for complex contract interactions

---

**Document Information**

- **Last Updated**: January 24, 2026
- **Repository Commit**: `98bd78a` (98bd78a7dd500eb9b68650bf73f4ab65a97a5c4f)
- **TzGo Version**: 1.17.0
- **Note**: This is a living document - refer to source code for authoritative information
